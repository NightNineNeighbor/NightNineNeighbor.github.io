---
title: HTTP완벽 가이드
key: 20190104
tags: Book
---



## HTTP 개관

### 웹 클라이언트와 서버

웹 서버는 HTTP 프로토콜로 의사소통하기 때문에 보통 HTTP서버라고 불린다.

### 리소스

웹 서버는 웹 리소스를 관리하고 제공한다.

#### 미디어 타입

인터넷은 수천 가지 데이터 아입을 다루 기 때문에, HTTP는 웹에서 전송되는 객체 각각에 신중하게 MIME(Multipurpose Internet Mail Extenstion, 다목적 인터넷 메일 확장)타엡이라는 데이터 포멧 라벨을 붙인다. MIME은 이메일에서 잘 동작했기 때문에 HTTP에서도 채택되었다.

MIME타입은 사선(/)으로 주타입과 부 타입으로 이루어진 문자열 라벨이다. 예를 들면

* HTML로 작성된 텍스트 문서 : text/html
* plain ASCII  텍스트 문서 text/plain
* JPEG이미지 image/jpeg
* GIF 이미지 image/gif
* 애플 퀵타임 동영상 video/quicktime
* MS 파워포인트 프레젠테이션 application/vnd.ms-powerpoint

#### URI

웹 서버 리소스는 각자 이름을 갖고 있기 때문에 클라이언트는 관심 있는 리소스를 지목할 수 있다.

서버 리소스 이름은 통합 자원 식별자(Uniform Resource Indentifier, URI)로 불린다.

ex) http://www.joes-hardware.com/specials/saw-blade.gif
URI에는 두가지가 있는 *URL*과 *URN*이다.

#### URL

통합 자원 지시자(Uniform Resource Locator, URL)는 리소스 식별자의 가장 흔한 형태다.URL은 특정 서버의 한 리소스에 대한 구체적인 위치를 서술한다. URL은 리소스가 정확히 어디에 있고 어떻게 접근할 수 있는지 분명하게 알려준다.

ex) 

* http://www.orelly.com/index.html 오라일리 출판사 홈페이지의 URL
* http://www.joes-hardware.com/inventory-check.cgi?item=12731 물품 #12731의 재고가 있는지 확인하는 프로그램에 대한 URL
* ftp://joe.tools4u@ftp.joes-hardware.com/locking-pliers.gif 비밀번호로 보호되는 FTP를 통해 locking-pliers.gif이미지 파일에 접근하는 URL

대부분의 URL은 세 부분으로 이루어진 표준 포맷을 따른다.

* scheme(스킴) : 리소스에 접근하기 위해 사용되는 프로토콜을 서술한다 . 보통 HTTP 프로토콜(http://)이다.
* 서버의 인터넷 주소를 제공한다 (ex www.joes-hardwoard.com)
* 웹 서버의 리소스 (ex /specials/saw-blade.gif)

오늘날 대부분의 URI는 URL이다.



### 트랜잭션

HTTP 트랜잭션은 요청명령과 응답결과로 이루어져 있다.

#### 메서드

HTTP는 HTTP메서드라 불리는 여러 종류의 요청 명령을 지원한다.

모든 HTTP요청은 한개의 메서드를 가진다.

#### 상태 코드

모든 HTTP응답 메시지는 상태 코드와 함께 반환된다.

HTTP는 각 숫자 생테코드에 텍스트로 된 "사유 구절(reason phrase)" 도 함게 보낸다. 이 구문은 단지 설명만을 위해서 포함된 것일 뿐 실제 응답 처리에는 숫자로 된 코드가 사용된다.

#### 웹 페이지는 여러 객체로 이루어질 수 있다.

웹페이지는 보통 하나의 리소스가 아닌 리소스의 모음이다.

### 메시지

HTTP 메시지는 단순한 줄 단위의 문자열이다. 텍스트이기 때문에 사람이 읽고 쓰기 쉽다.

요청 메시지와 응답 메시지가 있다. 다른 것은 없다.

HTTP 메시지는 다음의 세 부분으로 이루어 진다.

| 요청 메시지                     |        | 응답 메시지              |
| ------------------------------- | ------ | ------------------------ |
| GET /test/hi-three.txt HTTP 1.0 | 시작줄 | HTTP/1.0 200 OK          |
| Accept : text/*                 | 헤더   | Content-type: text/plain |
| Accept-language: ef,fr          |        | content-length : 19      |
|                                 | 본문   | Hi! I'm a message        |

* 시작줄
  * 요청이라면 무엇을 해야 하는지 응답이라면 무슨 일이 일어났는지 나타낸다.
* 헤더
  * 시작줄 다음에는 0개 이상의 헤더 필드가 이어진다.
  * 각 헤더필든느 쉬운 구문 분석을 위해 콜론(:)으로 구분되어 있는 하나의 이름과 하나의 값으로 구성된다.
  * 헤더 필드를 추가하려면 그저 한 줄을 더하기만 하면 된다.
  * 헤더는 빈 줄로 끝난다.
* 본문
  * 빈 줄 다음에는 어떤 종류의 데이터든 들어갈 수 있는 메시지 본문이 필요에 따라 올 수 있다.
  * 본문은 임의의 이진 데이터를 포함할 수 있다.



### TCP 커넥션

#### TCP/IP

HTTP는 네트워크 통신의 핵심적인 세부사항에 대해서 신경 쓰지 않는다. 대신 대중적이고 신뢰성 있는 인터넷 전송 프로토콜인 TCP/IP에게 맡긴다.

#### 접속, IP 주소, 포트 번호

HTTP클라이언트가 서버에 메시지를 전송할 수 있게 되기 전에, IP주소와 포트 번호를 사용해 클라이언트와 서버 사이에 TCP/IP커넥션을 맺어야 한다.

포트 : 복수의 상대에게 동시 접속하기 위한 IP주소 아래 설치된 서브 주소

1. 웹 브라우저는 서버의 URL에서 호스트 명을 추출한다.
2. 웹 브라우저는 서버의 호스트 명을 IP로 변환한다.
3. 웹 브라우저는 URL에서 포트번호를 (있다면) 추출한다.
4. 웹 브라우저는 웹 서버와 TCP 커넥션을 맺는다.
5. 웹 브라우저는 서버에 HTTP요청을 보낸다.
6. 서버는 웹 브라우저에 HTTP 응답을 돌려준다.
7. 커넥션이 닫히면, 웹 브라우저는 문서를 보여준다.

### 프로토콜 버전

#### HTTP/0.9

1991년의 HTTP 프로토 타입

심각한 디자인 결함이 있고 구식 클라이언트하고만 같이 사용할 수 있다.

Get메서드만 지원하며, 멀티미디어 콘텐츠에 대한 MIME타입이나 HTTP헤더, 버전 번호는 지원하지 않는다.

#### HTTP/1.0

버전 번호, HTTP 헤더, 추가 메서드, 멀티미디어 객체 처리를 추가했다.

HTTP/1.0 은 결코 잘 정의된 명세가 아니며, HTTP가 급성정하던 시기에 만들어진 잘 동작하는 용례들의 모음에 가깝다.

#### HTTP/1.0+

"keey alive" 커넥션, 가상 호스팅 지원, 프락시 연결 지원등 많은 기능이 공식적이지는 않지만 사실상의 HTTP 표준으로 추가되었다. 

이러한 규격 외의 확장된 HTTP 버전이다.

#### HTTP/1.1

설계의 구조적 결함 교정, 두드러진 성능 최적화, 잘못된 기능을 제거했으며 더 복잡해진 웹 애플리케이션과 배포를 지원한다.

현재의 HTTP 버젼이다.

#### HTTP/2.0

1.1의 성능 문제를 개선하기 위해 구굴의 SPDY프로토콜을 기반으로 설계가 진행중인 프로토콜이다.



### 웹의 구성요소

### 프락시

> 클라이언트와 서버 사이에 위치한 HTTP 중개자

클라이언트와 서버 사이에 위치하여, 클라이언트의 모든 HTTP 요청을 받아 서버에 전달한다(대개 요청을 수정한 후에).

### 캐시

> 많이 찾는 웹페이지를 클라이언트 가까이에 보관하는 HTTP 창고



### 게이트웨이

> 다른 애플리케이션과 연결된 특별한 웹 서버

서버의 중개자로 활동하는 특별한 서버.

HTTP 트래픽을 다른 프로토콜로변환하기 위해 사용된다. 게이트웨이는 언제나 스스로가 리소스를 갖고 있는 진짜 서버인 것처럼 요청을 다룬다.

### 터널

> 단순히 HTTP 통신을 전달하기만 하는 특별한 프락시



### 에이전트

> 자동화된 HTTP 요청을 만드는 준지능적 웹클라이언트

사용자를 위해 HTTP요청을 만들어주는 클라이언트 프로그램이다.

'스파이더'나 '웹로봇' 같은 것이다.



## URL과 리소스

### URL 문법

<스킴>://<사용자 이름>:<비밀번호>@<호스트>:<포트>/<경로>;<파라미터>?<질의>#<프래그먼트>

* 스킴 : 리소스를 가져오려면 어떤 프로토콜을 사용하여 서버에 접근해야 하는지 가리킨다.
* 사용자 이름 : 몇몇 스킴은 리소스에 접근하기 위해 사용자 이름을 필요로 한다.
* 비밀번호 : 사용자의 비밀번호를 가리키며,사용자 이름에 콜론(:)으로 이어서 기술한다.
* 호스트 : 리소스를 호스팅하는 서버의 호스트 명이나 IP 주소
* 포트 : 리소스를 호스팅하는 서버가 열어놓은 포트번호. 많은 스킴이 기본 포트를 가지고 있다.(HTTP의 경우 80)
* 파라미터 : 특정 스킴들에서 입력 파라미터를 기록하는 용도로 사용한다. 파라미터는 이름 /값을 쌍으로 가진다.
* 질의 : 스킴에서 애플리캐이션(데이터베이스, 게시한, 검색엔진등)에 파라미터를 전달하는데 쓰인다.
* 프래그먼트 : 리소스의 조각이나 일부분을 가리키는 이름이다. URL이 특정 객체를 가리킬 경우에 프래그먼트 필드는 서버에 전달되지 않는다. 이는 클라이언트에서만 사용한다.



### 안전하지 않은 문자

url 설계자들은 모든 인터넷 프로토콜로 URL이 전송되기를 바랬다. 그래서 이스케이프라는 기능을 추가해서 안전하지 않은 문자를 안전한 문자로 인코딩할 수 있게 하였다.

ex)

~ -> %72

공백 -> %20



## HTTP 메시지

### 메시지의 흐름

인바운드, 아웃바운드, 업스트림, 다운스트림

#### 메시지는 원 서버 방향을 인바운드로 하여 송신된다.

메시지가 원 서버로 향하는 것은 인바운드로 이동하는 거싱고, 모든 처리가 끝난 후에 메시지가 사용자 에이전트로 돌아오는 것은 아웃바운드읻.

#### 다운스트림으로 흐르는 메시지

모든 메시지는 다운스트림으로 흐른다. 메시지의 발송자는 수신자의 업스트림이다.

### 메시지의 각 부분

시작줄과 헤더는 그냥 줄 단위로 불리된 아스키 문자열이다. 헤더에서 한 줄을 띄우고 본문이 시작된다.

각 줄은 캐리지 리턴과 개행문자로 구성된 두 글자의 줄바꿈 문자열로 끝난다(CRLF).

#### 메시지 문법

요청 메시지의 형식

```
<메서드> <요청 URL> <버전>

<헤더>



<엔티티 본문>
```

```http
GET /specials/saw-blade.gif HTTP/1.0
HOST: www.joes-hardware.com

```

응답 메시지의 형식

```
<버전> <상태 코드> <사유 구절>
<헤더>

<엔티티 본문>
```

```http
HTTP/1.0 200 OK
Content-Type: image/gif
Content-Length: 8572

```

헤더나 엔티티 본문이 없더라도 HTTP 헤더의 집합은 항상 빈줄(그냥 CRLF)로 끝나야 함에 주의해야 한다.

긴 헤더 줄은 그들을 여러 줄로 쪼개서 더 읽기 쉽게 만들 수있는데 추가 줄 앞에는 최소 하나의 스페이스 혹은 탭 문자가 와야 한다.

```http
HTTP/1.0 200 OK
Content-Type: image/gif
Content-Length: 8572
Server: Test Server
	Version 1.0
```



## 커넥션 관리





























## 캐시

웹 캐시는 자주 쓰이는 문서의 사본을 자동으로 보관하는 HTTP장치다.

* 불필요한 데이터 전송을 막을 수 있다.
* 대역폭 병목을 줄인다.보통의 네트워크가 원격 서버보다 로컬 네트워크 클라이언트에 더 넓은 대역폭을 제공하기 때문이다.
* 갑작스런 요청 쇄도(뉴스 속보, 유명 인사와 관련된 사건)에 대처하기 좋다.


